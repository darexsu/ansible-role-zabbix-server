---
# zabbix_server
#   |   ├── install
#   |   |    ├── repo
#   |   |    ├── packages
#   |   |    └── dependencies
#   |   └── config
#   |        └── server.cnf
# mariadb
#       ├── install
#       └── actions
#            ├── create database
#            ├── create user
#            └── import server.sql

# zabbix_server -> global
zabbix_server:
  enabled: false
  version: "6.0"
  server_name: "Zabbix server"  
  db_type: "MYSQL"
  db_port: "3306"
  db_host: "localhost"
  db_name: "zabbix"
  db_user: "zabbix"
  db_password: "change_me"
  service:
    state: "started"
    enabled: true

# zabbix_server -> repo
zabbix_server_repo:
  enabled: true
  zabbix:
    deb: "deb http://repo.zabbix.com/zabbix/{{ zabbix_server.version }}/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} main"
    deb_key: "http://repo.zabbix.com/zabbix-official-repo.key"
    rpm: "http://repo.zabbix.com/zabbix/{{ zabbix_server.version }}/rhel/{{ ansible_distribution_major_version }}/x86_64/zabbix-release-{{ zabbix_server.version }}-1.el{{ ansible_distribution_major_version }}.noarch.rpm"
    rpm_key: "http://repo.zabbix.com/RPM-GPG-KEY-ZABBIX-A14FE591"

# zabbix_server -> install
zabbix_server_install:
  enabled: false
  packages:
    debian: [zabbix-server-mysql, zabbix-frontend-php, zabbix-sql-scripts, zabbix-agent]
    redhat: [zabbix-server-mysql, zabbix-web-mysql, zabbix-sql-scripts, zabbix-agent]
  dependencies:
    debian: [apt-transport-https, ca-certificates, gnupg2, lsb-release]
    redhat: []

# zabbix_server -> config
zabbix_server_conf:
  enabled: false
  file: "zabbix_server.conf"
  src: "zabbix_server_conf.j2"
  path:
    debian: "/etc/zabbix/"
    redhat: "/etc/zabbix/"
  backup: false
  vars:
    ListenPort: "10051"
    SourceIP: ""
    LogType: ""
    LogFile: "/var/log/zabbix/zabbix_server.log"
    LogFileSize: "0"
    DebugLevel: ""
    PidFile: "/var/run/zabbix/zabbix_server.pid"
    SocketDir: "/var/run/zabbix"
    DBHost: "{{ zabbix_server.db_host }}"
    DBName: "{{ zabbix_server.db_name }}"
    DBSchema: ""
    DBUser: "{{ zabbix_server.db_user }}"
    DBPassword: "{{ zabbix_server.db_password }}"
    DBSocket: ""
    DBPort: "{{ zabbix_server.db_port }}"
    HistoryStorageURL: ""
    HistoryStorageTypes: ""
    HistoryStorageDateIndex: ""
    ExportDir: ""
    ExportFileSize: ""
    ExportType: ""
    StartPollers: ""
    StartIPMIPollers: ""
    StartPreprocessors: ""
    StartPollersUnreachable: ""
    StartTrappers: ""
    StartPingers: ""
    StartDiscoverers: ""
    StartHTTPPollers: ""
    StartTimers: ""
    StartEscalators: ""
    StartAlerters: ""
    JavaGateway: ""
    JavaGatewayPort: ""
    StartJavaPollers: ""
    StartVMwareCollectors: ""
    VMwareFrequency: ""
    VMwarePerfFrequency: ""
    VMwareCacheSize: ""
    VMwareTimeout: ""
    SNMPTrapperFile: "/var/log/snmptrap/snmptrap.log"
    StartSNMPTrapper: ""
    ListenIP: ""
    HousekeepingFrequency: ""
    MaxHousekeeperDelete: ""
    CacheSize: ""
    CacheUpdateFrequency: "60"
    StartDBSyncers: ""
    HistoryCacheSize: ""
    HistoryIndexCacheSize: ""
    TrendCacheSize: ""
    ValueCacheSize: ""
    Timeout: "4"
    TrapperTimeout: ""
    UnreachablePeriod: ""
    UnavailableDelay: ""
    UnreachableDelay: ""
    AlertScriptsPath: "/usr/lib/zabbix/alertscripts"
    ExternalScripts: "/usr/lib/zabbix/externalscripts"
    FpingLocation: "/usr/bin/fping"
    Fping6Location: "/usr/bin/fping6"
    SSHKeyLocation: ""
    LogSlowQueries: "3000"
    TmpDir: ""
    StartProxyPollers: ""
    ProxyConfigFrequency: ""
    ProxyDataFrequency: ""
    StartLLDProcessors: ""
    AllowRoot: ""
    User: ""
    Include: ""
    SSLCertLocation: ""
    SSLKeyLocation: ""
    SSLCALocation: ""
    StatsAllowedIP: "127.0.0.1"
    LoadModulePath: ""
    LoadModule: ""
    TLSCAFile: ""
    TLSCRLFile: ""
    TLSCertFile: ""
    TLSKeyFile: ""
    TLSCipherCert13: ""
    TLSCipherCert: ""
    TLSCipherPSK13: ""
    TLSCipherPSK: ""
    TLSCipherAll13: ""
    TLSCipherAll: ""
    DBTLSConnect: ""
    DBTLSCAFile: ""
    DBTLSCertFile: ""
    DBTLSKeyFile: ""
    DBTLSCipher: ""
    DBTLSCipher13: ""
    ListenBacklog: ""

# mariadb -> global
mariadb:
  enabled: false
  version: "10.6"

# repo
mariadb_repo:
  enabled: true

# mariadb -> install
mariadb_install:
  enabled: false
  remove_old:
    enabled: false

# mariadb -> database
mariadb_database:
  zabbix_server:
    enabled: false
    remove_old: false
    login_user: "root"
    login_password: ""
    login_host: "localhost"
    login_port: "{{ zabbix_server.db_port }}"
    login_unix_socket: 
      debian: "/run/mysqld/mysqld.sock"
      redhat: "/var/lib/mysql/mysql.sock"
    name: "{{ zabbix_server.db_name }}"
    state: "present"
    target: ""
    encoding: "utf8"
    collation: "utf8_bin"    

# mariadb -> user
mariadb_user:
  zabbix_server:
    enabled: false
    login_user: "root"
    login_password: ""
    login_host: "localhost"
    login_port: "{{ zabbix_server.db_port }}"
    login_unix_socket: 
      debian: "/run/mysqld/mysqld.sock"
      redhat: "/var/lib/mysql/mysql.sock"
    name: "{{ zabbix_server.db_user }}"
    password: "{{ zabbix_server.db_password }}"
    state: "present"    
    privileges: 'zabbix.*:ALL'
    encrypted: false

# mariadb -> sql
mariadb_sql:
  zabbix_server:
    schema: false